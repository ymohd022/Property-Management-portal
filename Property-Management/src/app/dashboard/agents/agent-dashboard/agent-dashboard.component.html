<div class="agent-dashboard-container">
    <div class="dashboard-header">
      <h1 class="dashboard-title">Agent Dashboard</h1>
      <div class="dashboard-actions">
        <button mat-stroked-button>
          <mat-icon>calendar_today</mat-icon>
          <span>Jun 2023</span>
        </button>
        <button mat-raised-button color="primary">
          <mat-icon>add</mat-icon>
          <span>Add Lead</span>
        </button>
      </div>
    </div>
  
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading dashboard data...</p>
    </div>
  
    <div *ngIf="!isLoading" class="dashboard-content">
      <!-- KPI Cards -->
      <div class="kpi-cards">
        <app-kpi-card 
          title="Total Assignments" 
          [value]="dashboardData.kpis.totalAssignments" 
          icon="assignment"
          color="#1a3c8f">
        </app-kpi-card>
        
        <app-kpi-card 
          title="Total Leads" 
          [value]="dashboardData.kpis.totalLeads" 
          icon="people"
          color="#4361ee">
        </app-kpi-card>
        
        <app-kpi-card 
          title="Active Leads" 
          [value]="dashboardData.kpis.activeLeads" 
          icon="person_search"
          color="#ff9800">
        </app-kpi-card>
        
        <app-kpi-card 
          title="Total Sales" 
          [value]="dashboardData.kpis.totalSales" 
          icon="sell"
          color="#4caf50">
        </app-kpi-card>
        
        <app-kpi-card 
          title="Total Commission" 
          [value]="formatCurrency(dashboardData.kpis.totalCommission)"
          icon="payments"
          color="#4caf50"
          [isCurrency]="true">
        </app-kpi-card>
        
        <app-kpi-card 
          title="Pending Commission" 
          [value]="formatCurrency(dashboardData.kpis.pendingCommission)"
          icon="account_balance_wallet"
          color="#ff9800"
          [isCurrency]="true">
        </app-kpi-card>
      </div>
  
      <!-- Charts Row -->
      <div class="charts-row">
        <app-chart-card 
          title="Leads Performance" 
          subtitle="New vs Converted leads"
          class="leads-chart">
          <canvas id="leadsChart"></canvas>
        </app-chart-card>
        
        <app-chart-card 
          title="Sales Performance" 
          subtitle="Monthly sales"
          class="sales-chart">
          <canvas id="salesChart"></canvas>
        </app-chart-card>
        
        <app-chart-card 
          title="Commission Earnings" 
          subtitle="Monthly commission"
          class="commission-chart">
          <canvas id="commissionChart"></canvas>
        </app-chart-card>
      </div>
  
      <!-- Assigned Properties -->
      <div class="assigned-properties">
        <h2 class="section-title">Assigned Properties</h2>
        <div class="properties-grid">
          <mat-card *ngFor="let property of dashboardData.assignedProperties" class="property-card">
            <mat-card-header>
              <mat-card-title>{{ property.name }}</mat-card-title>
              <mat-card-subtitle>{{ property.location }}</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="property-stats">
                <div class="stat-item">
                  <span class="stat-label">Total Flats</span>
                  <span class="stat-value">{{ property.totalFlats }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Available</span>
                  <span class="stat-value">{{ property.availableFlats }}</span>
                </div>
              </div>
            </mat-card-content>
            <mat-card-actions align="end">
              <button mat-button color="primary" [routerLink]="['/properties', property.id]">
                View Details
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
      </div>
  
      <!-- Bottom Row -->
      <div class="bottom-row">
        <!-- Recent Leads -->
        <mat-card class="recent-leads">
          <mat-card-header>
            <mat-card-title>Recent Leads</mat-card-title>
            <mat-card-subtitle>Latest client inquiries</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <table mat-table [dataSource]="dashboardData.recentLeads" class="leads-table">
              <ng-container matColumnDef="clientName">
                <th mat-header-cell *matHeaderCellDef>Client</th>
                <td mat-cell *matCellDef="let lead">{{ lead.clientName }}</td>
              </ng-container>
              
              <ng-container matColumnDef="property">
                <th mat-header-cell *matHeaderCellDef>Property</th>
                <td mat-cell *matCellDef="let lead">{{ lead.property }}</td>
              </ng-container>
              
              <ng-container matColumnDef="flatNumber">
                <th mat-header-cell *matHeaderCellDef>Flat</th>
                <td mat-cell *matCellDef="let lead">{{ lead.flatNumber }}</td>
              </ng-container>
              
              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>Date</th>
                <td mat-cell *matCellDef="let lead">{{ formatDate(lead.date) }}</td>
              </ng-container>
              
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let lead">
                  <span class="status-badge" [ngClass]="getStatusClass(lead.status)">
                    {{ lead.status }}
                  </span>
                </td>
              </ng-container>
              
              <tr mat-header-row *matHeaderRowDef="['clientName', 'property', 'flatNumber', 'date', 'status']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['clientName', 'property', 'flatNumber', 'date', 'status'];"></tr>
            </table>
          </mat-card-content>
          <mat-card-actions align="end">
            <button mat-button color="primary">View All Leads</button>
          </mat-card-actions>
        </mat-card>
        
        <!-- Recent Sales -->
        <mat-card class="recent-sales">
          <mat-card-header>
            <mat-card-title>Recent Sales</mat-card-title>
            <mat-card-subtitle>Latest property sales</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <table mat-table [dataSource]="dashboardData.recentSales" class="sales-table">
              <ng-container matColumnDef="clientName">
                <th mat-header-cell *matHeaderCellDef>Client</th>
                <td mat-cell *matCellDef="let sale">{{ sale.clientName }}</td>
              </ng-container>
              
              <ng-container matColumnDef="property">
                <th mat-header-cell *matHeaderCellDef>Property</th>
                <td mat-cell *matCellDef="let sale">{{ sale.property }}</td>
              </ng-container>
              
              <ng-container matColumnDef="flatNumber">
                <th mat-header-cell *matHeaderCellDef>Flat</th>
                <td mat-cell *matCellDef="let sale">{{ sale.flatNumber }}</td>
              </ng-container>
              
              <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef>Amount</th>
                <td mat-cell *matCellDef="let sale">{{ formatCurrency(sale.amount) }}</td>
              </ng-container>
              
              <ng-container matColumnDef="commission">
                <th mat-header-cell *matHeaderCellDef>Commission</th>
                <td mat-cell *matCellDef="let sale">{{ formatCurrency(sale.commission) }}</td>
              </ng-container>
              
              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>Date</th>
                <td mat-cell *matCellDef="let sale">{{ formatDate(sale.date) }}</td>
              </ng-container>
              
              <tr mat-header-row *matHeaderRowDef="['clientName', 'property', 'flatNumber', 'amount', 'commission', 'date']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['clientName', 'property', 'flatNumber', 'amount', 'commission', 'date'];"></tr>
            </table>
          </mat-card-content>
          <mat-card-actions align="end">
            <button mat-button color="primary">View All Sales</button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>
  </div>
  